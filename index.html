<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•è‹±èªé›»å­æ›¸</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .word-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; width: 100%; max-width: 800px; }
        .word-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center; }
        .word-text { font-size: 28px; font-weight: bold; margin-bottom: 15px; cursor: pointer; color: #2d3436; }
        .word-text:hover { color: #0984e3; }
        button { margin: 5px; padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .btn-record { background: #ff7675; color: white; }
        .btn-stop { background: #636e72; color: white; display: none; }
        .btn-play { background: #55efc4; color: #2d3436; display: none; font-weight: bold; }
        .status-dot { height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .recording .status-dot { background-color: #ff4757; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <h1>ğŸ‡¬ğŸ‡§ è‹±èªç™¼éŸ³èˆ‡éŒ„éŸ³ç·´ç¿’</h1>
    <p>1. é»æ“Šå–®å­—è½è‹±å¼ç™¼éŸ³ | 2. æŒ‰éŒ„éŸ³é–‹å§‹ç·´ç¿’ | 3. æŒ‰åœæ­¢å¾Œé»æ’­æ”¾</p>

    <div class="word-grid" id="grid"></div>

    <script>
        // ä½ çš„ 7 å€‹è©èª
        const words = ["Apple", "Banana", "Cherry", "Dragonfruit", "Elderberry", "Fig", "Grape"];
        let mediaRecorder;
        let audioChunks = [];
        let audioUrls = {}; // å„²å­˜æ¯å€‹å–®å­—çš„éŒ„éŸ³ç¶²å€

        const grid = document.getElementById('grid');

        words.forEach((word, index) => {
            const card = document.createElement('div');
            card.className = 'word-card';
            card.id = `card-${index}`;
            card.innerHTML = `
                <div class="word-text" onclick="speak('${word}')">${word} ğŸ”Š</div>
                <div id="status-${index}"><span class="status-dot"></span>å¾…å‘½</div>
                <button class="btn-record" id="rec-${index}" onclick="startRecording(${index})">ğŸ¤ é–‹å§‹éŒ„éŸ³</button>
                <button class="btn-stop" id="stop-${index}" onclick="stopRecording(${index})">â¹ åœæ­¢</button>
                <button class="btn-play" id="play-${index}" onclick="playRecording(${index})">â–¶ï¸ è½å›æˆ‘çš„è²éŸ³</button>
            `;
            grid.appendChild(card);
        });

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-GB';
            window.speechSynthesis.speak(utterance);
        }

        async function startRecording(index) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) audioChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    if (audioUrls[index]) URL.revokeObjectURL(audioUrls[index]); // é‡‹æ”¾èˆŠè¨˜æ†¶é«”
                    audioUrls[index] = URL.createObjectURL(audioBlob);
                    document.getElementById(`play-${index}`).style.display = 'inline-block';
                    document.getElementById(`status-${index}`).innerHTML = '<span class="status-dot" style="background:#55efc4"></span>éŒ„éŸ³å·²å°±ç·’';
                };

                mediaRecorder.start();
                document.getElementById(`card-${index}`).classList.add('recording');
                document.getElementById(`rec-${index}`).style.display = 'none';
                document.getElementById(`stop-${index}`).style.display = 'inline-block';
                document.getElementById(`status-${index}`).innerHTML = '<span class="status-dot"></span>éŒ„éŸ³ä¸­...';
            } catch (err) {
                alert("ç„¡æ³•é–‹å•Ÿéº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™è¨­å®šï¼");
            }
        }

        function stopRecording(index) {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                // åœæ­¢æ‰€æœ‰éº¥å…‹é¢¨è»Œé“ä»¥ç¯€çœé›»åŠ›
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                document.getElementById(`card-${index}`).classList.remove('recording');
                document.getElementById(`stop-${index}`).style.display = 'none';
                document.getElementById(`rec-${index}`).style.display = 'inline-block';
            }
        }

        function playRecording(index) {
            if (audioUrls[index]) {
                const audio = new Audio(audioUrls[index]);
                audio.play();
            }
        }
    </script>
</body>
</html>
